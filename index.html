<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Config Panel — اشتراک کانفیگ</title>
<meta name="color-scheme" content="light">
<link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%23007BFF' d='M12 2L2 7v6c0 5 5 10 10 10s10-5 10-10V7L12 2z'/%3E%3C/svg%3E">
<!-- Feather icons -->
<script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
<style>
:root{
  --bg:#f5f7fb; --panel:#ffffff; --muted:#6b7280; --text:#111827;
  --line:#e6edf3; --accent:#007BFF; --success:#16a34a; --danger:#ef4444;
  --radius:12px; --shadow: 0 8px 24px rgba(2,6,23,0.06);
  --glass: rgba(255,255,255,0.7);
}
*{box-sizing:border-box}
html,body{height:100%; margin:0; font-family: Inter, "IRANSans", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background:var(--bg); color:var(--text); -webkit-font-smoothing:antialiased;}
body{display:flex;}

/* Sidebar */
#sidebar{
  width:64px; background:var(--panel); border-right:1px solid var(--line);
  height:100vh; position:fixed; left:0; top:0; padding:20px 8px; transition:width .28s ease;
  box-shadow: var(--shadow);
}
#sidebar.expanded{width:220px}
.logo{
  display:flex; gap:10px; align-items:center; justify-content:center; margin-bottom:20px;
}
.logo .shield{
  width:36px; height:36px; background:linear-gradient(135deg,var(--accent),#00a3ff); border-radius:8px; display:grid; place-items:center; color:white; box-shadow:0 6px 18px rgba(0,123,255,0.15);
}
.logo h1{margin:0;font-size:18px;font-weight:700;color:var(--accent); display:none}
#sidebar.expanded .logo h1{display:block}

/* menu */
.menu{display:flex;flex-direction:column; gap:8px;}
.menu button{all:unset; cursor:pointer; display:flex; align-items:center; gap:10px; padding:10px; border-radius:10px; color:var(--text); transition:all .18s; border:1px solid transparent;}
.menu button i{color:var(--accent);}
.menu button:hover{background:linear-gradient(90deg, rgba(0,123,255,0.06), transparent); transform:translateX(4px); border-color:var(--line)}
#toggleBtn{margin-top:12px; margin-bottom:8px; display:flex; justify-content:center; align-items:center; padding:8px; cursor:pointer; border-radius:8px; border:1px solid var(--line)}

/* Main layout */
.container{margin-left:64px; transition:margin-left .28s ease; width:100%;}
.container.expanded{margin-left:220px}
.header{padding:20px 28px; background:transparent; display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid var(--line)}
.brand{display:flex; gap:12px; align-items:center}
.brand h2{margin:0;font-size:20px;color:var(--accent);font-weight:700}
.header .note{color:var(--muted); font-size:13px}

/* Grid */
.content{padding:24px;}
.row{display:grid; grid-template-columns: 1fr 360px; gap:20px}
@media(max-width:980px){ .row{grid-template-columns:1fr} .sidebar-hide{display:none} }

/* Panels */
.panel{background:var(--panel); border-radius:var(--radius); padding:16px; box-shadow:var(--shadow); border:1px solid var(--line)}
.panel h3{margin:0 0 12px; font-size:16px}

/* inputs */
.input, textarea, select{width:100%; padding:10px 12px; border:1px solid #dfe9f5; border-radius:10px; background:#fff; font-size:14px; color:var(--text)}
textarea{min-height:100px; resize:vertical}

/* list */
.list{display:flex; flex-direction:column; gap:12px; margin-top:12px}
.card{border:1px solid var(--line); border-radius:12px; padding:12px; display:flex; flex-direction:column; gap:8px; background:linear-gradient(180deg,#fff,#fbfdff)}
.card .meta{display:flex; justify-content:space-between; align-items:center; gap:8px}
.badge{padding:6px 8px; font-size:12px; border-radius:999px; border:1px solid #eef6ff; background:#f0f8ff; color:var(--accent)}

/* actions */
.actions{display:flex; gap:8px; margin-top:6px}
.btn{padding:8px 12px; border-radius:10px; border:1px solid var(--line); background:#fff; cursor:pointer; font-weight:600}
.btn.copy{color:var(--accent); border-color:rgba(0,123,255,0.12)}
.btn.dl{color:#0b6f3a; border-color:rgba(16,185,129,0.12)}
.btn.del{color:var(--danger); border-color:rgba(239,68,68,0.12)}

/* small text */
.small{font-size:13px;color:var(--muted)}

/* footer */
.footer{padding:16px 24px; text-align:center; color:var(--muted); font-size:13px; border-top:1px dashed var(--line); margin-top:18px}

/* legal note */
.legal{font-size:12px;color:#8b94a6;padding:10px;border-radius:8px;background:#fbfdff;margin-bottom:12px;border:1px solid #eef6ff}

/* search */
.searchBox{display:flex; gap:8px; align-items:center}
.searchBox input{flex:1}

/* empty */
.empty{text-align:center;color:var(--muted);padding:24px;border-radius:12px;border:1px dashed var(--line); background:#fff;}

/* subtle animations */
.fadeIn{animation:fadeIn .36s ease both}
@keyframes fadeIn{from{opacity:0; transform:translateY(8px)} to{opacity:1; transform:none}}
</style>
</head>
<body>
  <!-- Sidebar -->
  <aside id="sidebar" class="">
    <div id="toggleBtn" title="باز/بسته کردن منو"><i data-feather="menu"></i></div>
    <div class="logo">
      <div class="shield" aria-hidden="true"><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M12 2L3 6v5c0 5 4 9 9 9s9-4 9-9V6l-9-4z" fill="white"/></svg></div>
      <h1>RLAX</h1>
    </div>

    <nav class="menu">
      <button data-section="home"><i data-feather="home"></i><span class="label">صفحه اصلی</span></button>
      <button data-section="manage"><i data-feather="lock"></i><span class="label">پنل مدیریت</span></button>
      <button data-section="about"><i data-feather="info"></i><span class="label">درباره</span></button>
    </nav>
  </aside>

  <!-- Main -->
  <div class="container" id="mainContainer">
    <header class="header">
      <div class="brand"><h2>RLAX</h2><div class="small">پنل اشتراک کانفیگ</div></div>
      <div class="note small legal">تذکر: این سرویس صرفاً برای انتشار کانفیگ‌هاست. مسئولیت استفاده برعهده کاربر است.</div>
    </header>

    <div class="content">
      <div class="row">
        <!-- left: list -->
        <section style="min-height:300px">
          <div class="panel">
            <div style="display:flex; justify-content:space-between; align-items:center; gap:12px;">
              <h3>کانفیگ‌ها</h3>
              <div class="searchBox" style="width:50%;">
                <input id="searchInput" class="input" placeholder="جستجو بر اساس عنوان، توضیح یا نوع..." />
              </div>
            </div>

            <div id="filters" style="margin-top:12px; display:flex; gap:8px; flex-wrap:wrap;">
              <button class="btn" data-filter="all">همه</button>
              <button class="btn" data-filter="vmess">vmess</button>
              <button class="btn" data-filter="vless">vless</button>
              <button class="btn" data-filter="trojan">trojan</button>
              <button class="btn" data-filter="other">دیگر</button>
            </div>

            <div id="listArea" class="list" style="margin-top:14px"></div>

            <div id="emptyNote" class="empty" style="display:none">هیچ کانفیگی اضافه نشده — وارد پنل مدیریت شو.</div>
          </div>
        </section>

        <!-- right: manage panel -->
        <aside style="position:sticky; top:24px;">
          <div id="managePanel" class="panel">
            <h3>ورود مدیر</h3>
            <div id="loginBox">
              <input id="adminPassword" class="input" type="password" placeholder="رمز پنل مدیر" />
              <div style="display:flex; gap:8px; margin-top:8px;">
                <button id="loginBtn" class="btn">ورود</button>
                <button id="logoutBtn" class="btn" style="display:none">خروج</button>
              </div>
              <div id="loginMsg" class="small" style="margin-top:8px;color:var(--danger)"></div>
            </div>

            <div id="editor" style="margin-top:12px; display:none">
              <h3 style="margin-top:0">افزودن کانفیگ جدید</h3>
              <input id="cfgTitle" class="input" placeholder="عنوان (مثلاً: سرور تهران 1)" />
              <select id="cfgType" class="input">
                <option value="">انتخاب نوع کانفیگ</option>
                <option value="vmess">vmess</option>
                <option value="vless">vless</option>
                <option value="trojan">trojan</option>
                <option value="other">دیگر</option>
              </select>
              <textarea id="cfgText" class="input" placeholder="چسباندن کانفیگ (متن) — یا فایل را آپلود کن"></textarea>
              <input id="cfgFile" type="file" class="input" />
              <div style="display:flex; gap:8px; margin-top:8px;">
                <button id="addCfgBtn" class="btn">ذخیره در پنل</button>
                <button id="clearEditor" class="btn">پاک کردن</button>
              </div>
              <div class="small" style="margin-top:8px; color:var(--muted)">کانفیگ‌ها در مرورگر شما ذخیره می‌شوند (LocalStorage). برای انتشار روی سرور/هاست، فایل‌ها را دانلود و آپلود کن.</div>
            </div>
          </div>

          <div class="panel" style="margin-top:12px">
            <h3>امکانات</h3>
            <div style="display:flex; flex-direction:column; gap:8px;">
              <button id="exportBtn" class="btn">تهیهٔ نسخه پشتیبان (export JSON)</button>
              <button id="importBtn" class="btn">بازیابی از فایل (import)</button>
              <input id="importFile" type="file" accept="application/json" style="display:none" />
              <button id="clearAllBtn" class="btn" style="color:var(--danger)">حذف همه کانفیگ‌ها</button>
            </div>
          </div>

          <div class="panel" style="margin-top:12px">
            <h3>درباره</h3>
            <div class="small">این پنل برای مدیریت و اشتراک‌گذاری کانفیگ‌ها طراحی شده — بدون اجرای سرور یا ارائه خدمات شبکه.</div>
          </div>
        </aside>
      </div>

      <div class="footer">طراحی شده توسط گروه رلکس | RLAX</div>
    </div>
  </div>

<script>
/* ---------- Initialization ---------- */
feather.replace();

/* Admin password (client-side) */
const ADMIN_PASS = "Hh2ratu/("; // تغییر دهید در صورت نیاز

/* Elements */
const sidebar = document.getElementById('sidebar');
const toggleBtn = document.getElementById('toggleBtn');
const mainContainer = document.getElementById('mainContainer');
const menuButtons = document.querySelectorAll('#sidebar .menu button');

const loginBtn = document.getElementById('loginBtn');
const logoutBtn = document.getElementById('logoutBtn');
const adminPassword = document.getElementById('adminPassword');
const loginMsg = document.getElementById('loginMsg');

const editor = document.getElementById('editor');
const loginBox = document.getElementById('loginBox');

const cfgTitle = document.getElementById('cfgTitle');
const cfgType = document.getElementById('cfgType');
const cfgText = document.getElementById('cfgText');
const cfgFile = document.getElementById('cfgFile');
const addCfgBtn = document.getElementById('addCfgBtn');
const clearEditor = document.getElementById('clearEditor');

const listArea = document.getElementById('listArea');
const emptyNote = document.getElementById('emptyNote');
const searchInput = document.getElementById('searchInput');
const filterBtns = document.querySelectorAll('#filters .btn');

const exportBtn = document.getElementById('exportBtn');
const importBtn = document.getElementById('importBtn');
const importFile = document.getElementById('importFile');
const clearAllBtn = document.getElementById('clearAllBtn');

/* Sidebar initial collapsed */
sidebar.classList.remove('expanded');
mainContainer.classList.remove('expanded');

/* Toggle sidebar */
toggleBtn.addEventListener('click', () => {
  sidebar.classList.toggle('expanded');
  mainContainer.classList.toggle('expanded');
});

/* Menu navigation */
menuButtons.forEach(btn=>{
  btn.addEventListener('click', ()=>{
    const sec = btn.dataset.section;
    if(sec === 'manage'){
      sidebar.classList.add('expanded'); mainContainer.classList.add('expanded');
      showManage();
    } else if(sec === 'home'){
      showHome();
    } else if(sec === 'about'){
      alert('پنل مدیریت کانفیگ — RLAX');
    }
  });
});

/* ---------- Auth (simple client-side) ---------- */
function setLoggedIn(flag){
  if(flag){
    loginBox.style.display='none';
    editor.style.display='block';
    logoutBtn.style.display='inline-block';
    loginMsg.textContent='';
  } else {
    loginBox.style.display='block';
    editor.style.display='none';
    logoutBtn.style.display='none';
  }
}

/* Check if session active */
let session = sessionStorage.getItem('rlax_admin') === '1';
setLoggedIn(session);

loginBtn.addEventListener('click', ()=>{
  const v = adminPassword.value || '';
  if(v === ADMIN_PASS){
    sessionStorage.setItem('rlax_admin','1');
    session = true;
    setLoggedIn(true);
    adminPassword.value='';
    alert('شما وارد شدید — پنل مدیریت فعال شد.');
    renderList();
  } else {
    loginMsg.textContent = 'رمز اشتباه است';
  }
});

logoutBtn.addEventListener('click', ()=>{
  sessionStorage.removeItem('rlax_admin');
  session = false;
  setLoggedIn(false);
});

/* ---------- Data model in localStorage ---------- */
function loadData(){
  try{
    return JSON.parse(localStorage.getItem('rlax_configs')||'[]');
  }catch(e){ return [] }
}
function saveData(arr){
  localStorage.setItem('rlax_configs', JSON.stringify(arr));
}

/* ---------- Rendering list ---------- */
function renderList(filter = {q:'',type:'all'}) {
  const data = loadData();
  let shown = data.slice(); // copy
  if(filter.type && filter.type !== 'all'){
    shown = shown.filter(it => (it.type||'other').toLowerCase() === filter.type.toLowerCase());
  }
  if(filter.q){
    const q = filter.q.toLowerCase();
    shown = shown.filter(it => (it.title||'').toLowerCase().includes(q) || (it.desc||'').toLowerCase().includes(q) || (it.type||'').toLowerCase().includes(q));
  }
  listArea.innerHTML = '';
  if(shown.length === 0){
    emptyNote.style.display = 'block';
    return;
  } else emptyNote.style.display = 'none';

  shown.forEach((it, idx) => {
    const card = document.createElement('div');
    card.className = 'card fadeIn';
    const meta = document.createElement('div');
    meta.className = 'meta';
    const left = document.createElement('div');
    left.innerHTML = `<div style="font-weight:700">${escapeHtml(it.title||'بدون عنوان')}</div><div class="small">${escapeHtml(it.desc||'')}</div>`;
    const right = document.createElement('div');
    right.innerHTML = `<div class="badge">${escapeHtml(it.type||'other')}</div>`;
    meta.appendChild(left); meta.appendChild(right);
    card.appendChild(meta);

    // files / text preview
    if(it.text && it.text.trim()){
      const pre = document.createElement('pre');
      pre.style.maxHeight='220px'; pre.style.overflow='auto'; pre.style.padding='10px'; pre.style.borderRadius='8px'; pre.style.background='#fbfdff'; pre.style.border='1px solid var(--line)';
      pre.textContent = it.text;
      card.appendChild(pre);
    }
    if(it.files && it.files.length){
      it.files.forEach(f=>{
        const ext = (f.name||'').split('.').pop().toLowerCase();
        if(f.type && f.type.startsWith('image/')){
          const img = document.createElement('img'); img.src = f.url; img.alt = f.name; img.style.maxWidth='100%'; img.style.borderRadius='8px'; img.style.marginTop='8px';
          card.appendChild(img);
        } else if(f.type && f.type.startsWith('video/')){
          const vid = document.createElement('video'); vid.src = f.url; vid.controls=true; vid.style.width='100%'; vid.style.borderRadius='8px'; vid.style.marginTop='8px';
          card.appendChild(vid);
        } else {
          const a = document.createElement('a'); a.href = f.url; a.download = f.name; a.textContent = 'دانلود ' + f.name; a.className='btn dl'; a.style.display='inline-block'; a.style.marginTop='8px';
          card.appendChild(a);
        }
      });
    }

    // actions
    const actions = document.createElement('div');
    actions.className = 'actions';
    // copy first: prefer text, else file URL of first file
    const copyBtn = document.createElement('button'); copyBtn.className='btn copy'; copyBtn.textContent='کپی';
    copyBtn.addEventListener('click', ()=> {
      const toCopy = it.text && it.text.trim() ? it.text : (it.files && it.files[0] ? it.files[0].url : '');
      if(!toCopy) return alert('محتوایی برای کپی موجود نیست');
      navigator.clipboard.writeText(toCopy).then(()=>alert('کپی شد'));
    });
    actions.appendChild(copyBtn);

    // download all as zip? (simple: download text as .txt and file links individually)
    const dlBtn = document.createElement('button'); dlBtn.className='btn dl'; dlBtn.textContent='دانلود';
    dlBtn.addEventListener('click', ()=>{
      if(it.text && it.text.trim()){
        const blob = new Blob([it.text], {type:'text/plain;charset=utf-8'});
        const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = (it.title || 'config') + '.txt'; a.click(); URL.revokeObjectURL(a.href);
      } else if(it.files && it.files[0]){
        // download first file
        const a = document.createElement('a'); a.href = it.files[0].url; a.download = it.files[0].name; a.click();
      } else alert('فایلی برای دانلود وجود ندارد');
    });
    actions.appendChild(dlBtn);

    if(session){
      const delBtn = document.createElement('button'); delBtn.className='btn del'; delBtn.textContent='حذف';
      delBtn.addEventListener('click', ()=>{
        if(confirm('آیا مطمئنی که می‌خواهی این کانفیگ را حذف کنی؟')){
          deleteByIndex(idx);
        }
      });
      actions.appendChild(delBtn);
    }

    card.appendChild(actions);
    listArea.appendChild(card);
  });

  // helper: deleteByIndex inside shown not original: map to actual indices
  function deleteByIndex(shownIndex){
    // compute actual index in storage
    const all = loadData();
    // if filters active, find corresponding item by identity (title+desc+timestamp)
    const item = shown[shownIndex];
    // find item index by matching createdAt if present
    let actualIndex = all.findIndex(x => x.id === item.id);
    if(actualIndex === -1){
      // fallback: try title+desc
      actualIndex = all.findIndex(x => x.title === item.title && x.desc === item.desc);
    }
    if(actualIndex !== -1){
      all.splice(actualIndex,1);
      saveData(all);
      renderList({q: searchInput.value.trim(), type:currentFilter});
    } else {
      alert('خطا در حذف');
    }
  }
}

/* ---------- Utilities ---------- */
function escapeHtml(s){ return String(s||''); }

/* ---------- Adding new config ---------- */
addCfgBtn.addEventListener('click', async ()=>{
  const title = cfgTitle.value.trim();
  const type = cfgType.value || 'other';
  const text = cfgText.value.trim();
  const fileInput = cfgFile.files;
  if(!title) return alert('عنوان وارد کن');
  const files = [];
  for(let f of fileInput){
    // create object URL (note: will be local)
    const url = URL.createObjectURL(f);
    files.push({name: f.name, type: f.type, url});
  }
  const id = 'c_' + Date.now() + '_' + Math.random().toString(36).slice(2,8);
  const entry = {id, title, desc: '', type, text, files, createdAt: Date.now()};
  // store
  const arr = loadData();
  arr.unshift(entry);
  saveData(arr);
  // clear
  cfgTitle.value=''; cfgText.value=''; cfgFile.value='';
  alert('کانفیگ ذخیره شد');
  renderList({q: searchInput.value.trim(), type: currentFilter});
});

/* support clearing editor */
clearEditor.addEventListener('click', ()=>{ cfgTitle.value=''; cfgText.value=''; cfgFile.value=''; cfgType.value=''; });

/* ---------- Search & filter ---------- */
let currentFilter = 'all';
searchInput.addEventListener('input', ()=>{
  renderList({q: searchInput.value.trim(), type: currentFilter});
});
filterBtns.forEach(b=>{
  b.addEventListener('click', ()=>{
    filterBtns.forEach(x=>x.style.boxShadow='none');
    b.style.boxShadow='0 6px 18px rgba(0,123,255,0.12)';
    currentFilter = b.dataset.filter || 'all';
    renderList({q: searchInput.value.trim(), type: currentFilter});
  });
});

/* ---------- Export / Import / Clear ---------- */
exportBtn.addEventListener('click', ()=>{
  const data = loadData();
  const blob = new Blob([JSON.stringify(data, null, 2)], {type:'application/json'});
  const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'rlax-configs-backup.json'; a.click(); URL.revokeObjectURL(a.href);
});

importBtn.addEventListener('click', ()=> importFile.click());
importFile.addEventListener('change', ()=>{
  const f = importFile.files[0];
  if(!f) return;
  const reader = new FileReader();
  reader.onload = e => {
    try{
      const data = JSON.parse(e.target.result);
      if(!Array.isArray(data)) throw new Error('فرمت نامعتبر');
      // merge (prepend)
      const cur = loadData();
      const merged = data.concat(cur);
      saveData(merged);
      alert('واردسازی انجام شد');
      renderList({q: searchInput.value.trim(), type: currentFilter});
    }catch(er){ alert('خطا در واردسازی: ' + er.message) }
  };
  reader.readAsText(f);
});

clearAllBtn.addEventListener('click', ()=>{
  if(!confirm('آیا از حذف کامل همهٔ کانفیگ‌ها مطمئنی؟')) return;
  localStorage.removeItem('rlax_configs');
  renderList({q: searchInput.value.trim(), type: currentFilter});
});

/* ---------- Manage panel visibility helpers ---------- */
function showManage(){
  // expand sidebar already handled
  // open login or editor depending on session
  if(session){
    loginBox.style.display='none'; editor.style.display='block';
  } else {
    loginBox.style.display='block'; editor.style.display='none';
  }
  // scroll to manage
  window.scrollTo({top:0, behavior:'smooth'});
}
function showHome(){
  // collapse main to home view
  // hide both login/editor in side panel
  loginBox.style.display='none'; editor.style.display='none';
  window.scrollTo({top:0, behavior:'smooth'});
}

/* Initial render */
renderList({q:'', type:'all'});

/* expose renderList to global (for deletion inside card) */
window.renderList = renderList;
</script>
</body>
  </html>
